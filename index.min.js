class t extends Error{constructor(t,e,s){super(),this.name="TemplateError";let i="\n------------------\n";i+=`Template: \`${t}\``,i+="\n------------------\n",i+=`Tags: ${JSON.stringify(e,null,2)}`,i+="\n------------------\n",i+=s,this.message=i}}class e extends HTMLElement{static get observedAttributes(){return["src"]}attributeChangedCallback(t,e,s){this.__initialized&&e!==s&&(this[t]=s)}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t),this.setSrc(t)}get value(){return this.__data}set value(t){this.setValue(t)}constructor(){super(),this.__initialized=!1,this.__theme=null,this.__data=null,this.__table=null,this.__column=null,this.__headers=null,this.__selected=null}async connectedCallback(){this.__table=document.createElement("table"),this.hasAttribute("theme")?(this.__theme=document.createElement("template"),this.__theme.innerHTML=await this.getTheme(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.__theme.content.cloneNode(!0)),this.shadowRoot.appendChild(this.__table)):this.appendChild(this.__table),this.hasAttribute("src")&&this.setSrc(),this.__initialized=!0}async getTheme(){const e=this.getAttribute("theme");return function(e,s={}){const i=Object.keys(s),a=Object.values(s);try{return new Function(...i,`return \`${e}\`;`)(...a)}catch(i){throw new t(e,s,i)}}(await this.fetchTheme(e))}async fetchTheme(t){const e=await fetch(t);if(200!==e.status)throw Error(`ERR ${e.status}: ${e.statusText}`);return e.text()}async setSrc(){this.hasAttribute("src")&&(this.__data=await this.fetchSrc(this.src),this.render())}async fetchSrc(t){const e=await fetch(t);if(200!==e.status)throw Error(`ERR ${e.status}: ${e.statusText}`);return e.json()}setValue(t){this.__data=t,this.render()}sortData(t){if(null===this.__column)return t;const e=this.__column,s=this.__direction?(t,e)=>t<e:(t,e)=>t>e;return t.sort((t,i)=>s(t[e],i[e])?-1:1)}headerClicked(t){this.__selected=t.target.cellIndex;const e=t.target.cellIndex;this.__direction=e!==this.__column||!this.__direction,this.__column=e,this.render()}styleHeaders(){const t=this.__direction?"asc":"desc",e=this.__direction?"asc":"desc";for(const s of this.__headers.children)s.cellIndex===this.__selected?s.classList.contains(e)?s.classList.remove(e):s.classList.add(t):(s.classList.contains(t)&&s.classList.remove(t),s.classList.contains(e)&&s.classList.remove(e))}render(){let t=[...this.__data];const e=document.createElement("table");this.__headers=document.createElement("tr"),this.__headers.addEventListener("click",t=>this.headerClicked(t)),t.shift().forEach(t=>{const e=document.createElement("th");e.innerText=t,this.__headers.appendChild(e)}),this.styleHeaders();const s=document.createElement("thead");s.appendChild(this.__headers),e.appendChild(s),t=this.sortData(t);const i=document.createElement("tbody");if(t.forEach(t=>{const e=document.createElement("tr");t.forEach(t=>{const s=document.createElement("td");t instanceof HTMLElement?s.appendChild(t):s.innerText=t,s.innerText=t,e.appendChild(s)}),i.appendChild(e)}),e.appendChild(i),this.__theme)this.shadowRoot.removeChild(this.__table),this.__table=e,this.shadowRoot.appendChild(this.__table);else{try{this.removeChild(this.__table)}catch(t){}this.__table=e,this.appendChild(this.__table)}}}customElements.define("wc-sortable-table",e);export{e as WCSortableTable};
